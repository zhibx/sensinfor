# 规则管理重构说明

## 改进概述

重构了规则管理编辑器,使其更加用户友好,支持直接在 UI 中管理文件路径和正则表达式,无需导出 JSON 手动编辑。

## 新增功能

### 1. 标签页式编辑器

规则编辑器现在分为三个标签页:

- **基本信息**: 规则名称、描述、类别、严重程度、标签、修复建议
- **检测模式**: 管理文件路径和 HTTP 方法
- **正则匹配**: 管理正则表达式规则

### 2. 检测模式管理

在 "检测模式" 标签页中,您可以:

- ✅ 添加/删除多个检测模式
- ✅ 编辑 URL 路径 (支持变量: `{filename}`, `{ext}`, `{dir}`)
- ✅ 选择 HTTP 方法 (GET, HEAD, POST, OPTIONS)
- ✅ 配置期望的状态码

**路径变量示例**:
- `/.git/config` - 固定路径
- `/backup/{filename}.{ext}` - 动态路径
- `/{dir}/config.{ext}` - 目录和扩展名变量

### 3. 正则表达式管理

在 "正则匹配" 标签页中,您可以:

- ✅ 为每个检测模式添加/删除多个正则表达式
- ✅ 实时验证正则表达式语法
- ✅ 内置正则测试工具,可以测试正则是否匹配特定文本
- ✅ 显示错误提示,帮助修复语法错误

**正则表达式示例**:
- `\[core\]` - 匹配 Git 配置的 [core] 部分
- `api[_-]?key` - 匹配 "apikey", "api_key", "api-key"
- `password\s*[:=]` - 匹配密码配置

### 4. 实时测试工具

每个正则表达式下方都有一个测试工具:
1. 输入测试文本
2. 点击 "测试" 按钮
3. 查看匹配结果 (绿色表示匹配成功)

## 使用方法

### 创建新规则

1. 点击 "新建规则" 按钮
2. 在 "基本信息" 标签页填写规则信息
3. 切换到 "检测模式" 标签页,添加文件路径
4. 切换到 "正则匹配" 标签页,添加内容匹配规则
5. 点击 "保存规则"

### 编辑现有规则

1. 在规则列表中找到要编辑的规则
2. 点击编辑图标
3. 在各标签页中修改配置
4. 点击 "保存规则"

### 示例: 创建自定义备份文件检测规则

**基本信息**:
- 名称: "备份文件泄露检测"
- 描述: "检测网站是否存在备份文件"
- 类别: 备份
- 严重程度: 中危

**检测模式**:
- 路径 1: `/backup.{ext}` (检测 backup.zip, backup.sql 等)
- 路径 2: `/{filename}.bak` (检测 .bak 后缀文件)
- HTTP 方法: GET
- 状态码: 200

**正则匹配** (可选):
- 如果需要验证文件内容,可以添加正则表达式
- 例如: `CREATE TABLE` (验证是否为 SQL 文件)

## 技术实现

- 使用 React Hooks 管理状态
- 实时表单验证
- 正则表达式语法检查器
- 内联测试工具

## 向后兼容

所有现有规则完全兼容,旧的规则配置会自动适配新的编辑器界面。

## 导入/导出

除了 UI 编辑,您仍然可以:
- 导出规则为 JSON 文件
- 在外部编辑 JSON 文件 (支持更高级的配置)
- 重新导入规则

---

**版本**: 3.0.0
**更新日期**: 2026-02-03
