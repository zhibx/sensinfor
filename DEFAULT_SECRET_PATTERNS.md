# 默认密钥检测规则说明

## 概述

系统内置了 29 条常用的密钥检测规则,涵盖身份证、手机号、云服务密钥、认证令牌、Webhook URL 等多种敏感信息类型。

## 规则列表

### 身份信息

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `id_card` | 二代身份证 | 检测中国二代身份证号码 | ✅ 启用 | 高危 |
| `phone` | 手机号 | 检测中国大陆手机号码 | ❌ 禁用 | 中危 |

### 云服务密钥

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `Aliyun_AK_ID` | 阿里云 AccessKey ID | 检测阿里云 AccessKey | ✅ 启用 | 高危 |
| `QCloud_AK_ID` | 腾讯云 AccessKey ID | 检测腾讯云 AccessKey | ✅ 启用 | 高危 |
| `JDCloud_AK_ID` | 京东云 AccessKey ID | 检测京东云 AccessKey | ✅ 启用 | 高危 |
| `AWS_AK_ID` | 亚马逊 AccessKey ID | 检测 AWS AccessKey | ✅ 启用 | 高危 |
| `VolcanoEngine_AK_ID` | 火山引擎 AccessKey ID | 检测火山引擎 AccessKey | ✅ 启用 | 高危 |
| `Kingsoft_AK_ID` | 金山云 AccessKey ID | 检测金山云 AccessKey | ✅ 启用 | 高危 |
| `GCP_AK_ID` | 谷歌云 AccessKey ID | 检测 Google Cloud API Key | ✅ 启用 | 高危 |

### 认证令牌

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `jwt_token` | JWT Token | 检测 JSON Web Token | ✅ 启用 | 高危 |
| `bearer_token` | Bearer Token | 检测 Bearer 认证令牌 | ✅ 启用 | 高危 |
| `basic_token` | Basic Token | 检测 Basic 认证令牌 | ✅ 启用 | 高危 |
| `auth_token` | Auth Token | 检测 Authorization 令牌 | ✅ 启用 | 高危 |
| `private_key` | Private Key | 检测私钥文件内容 | ✅ 启用 | 高危 |

### 代码托管平台

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `gitlab_v2_token` | GitLab V2 Token | 检测 GitLab Personal Access Token | ✅ 启用 | 高危 |
| `github_token` | GitHub Token | 检测 GitHub Personal Access Token | ✅ 启用 | 高危 |

### 微信生态

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `wechat_appid` | 微信 APPID | 检测微信公众号/小程序 APPID | ✅ 启用 | 中危 |
| `wechat_corpid` | 企业微信 CorpID | 检测企业微信 CorpID | ✅ 启用 | 中危 |
| `wechat_id` | 微信公众号 ID | 检测微信公众号唯一标识 | ✅ 启用 | 低危 |
| `wechat_webhookurl` | 企业微信 Webhook | 检测企业微信 Webhook URL | ✅ 启用 | 中危 |

### 第三方服务

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `qcloud_api_gateway_appkey` | 腾讯云 API 网关 | 检测腾讯云 API 网关 APPKEY | ✅ 启用 | 高危 |
| `dingtalk_webhookurl` | 钉钉 Webhook | 检测钉钉 Webhook URL | ✅ 启用 | 中危 |
| `feishu_webhookurl` | 飞书 Webhook | 检测飞书 Webhook URL | ✅ 启用 | 中危 |
| `slack_webhookurl` | Slack Webhook | 检测 Slack Webhook URL | ✅ 启用 | 中危 |
| `grafana_api_key` | Grafana API Key | 检测 Grafana API Key | ✅ 启用 | 高危 |
| `grafana_cloud_api_token` | Grafana Cloud Token | 检测 Grafana Cloud API Token | ✅ 启用 | 高危 |
| `grafana_service_account_token` | Grafana 服务账号 | 检测 Grafana Service Account Token | ✅ 启用 | 高危 |

### 应用配置

| ID | 名称 | 描述 | 默认状态 | 严重程度 |
|----|------|------|----------|----------|
| `password` | 密码字段 | 检测配置中的密码字段 | ✅ 启用 | 高危 |
| `app_key` | 前端应用密钥 | 检测前端应用配置中的密钥 | ✅ 启用 | 高危 |

## 使用说明

### 查看规则

1. 打开扩展 → 设置 → 分析引擎
2. 在"密钥提取"卡片中可以看到所有规则
3. 每个规则显示名称、描述、启用状态

### 启用/禁用规则

1. 在规则列表中找到要修改的规则
2. 点击编辑图标
3. 勾选/取消"启用此规则"复选框
4. 保存

### 修改规则

1. 点击规则的编辑按钮
2. 可以修改:
   - 名称和描述
   - 正则表达式
   - 严重程度
   - 启用状态
3. 使用测试工具验证正则表达式
4. 保存修改

### 添加自定义规则

1. 点击"添加规则"按钮
2. 填写规则信息
3. 输入正则表达式
4. 测试验证
5. 保存

## 正则表达式说明

### 特殊字符转义

在 JavaScript 正则表达式中,某些字符需要转义:
- `\b` - 单词边界
- `\d` - 数字 (等价于 [0-9])
- `\s` - 空白字符
- `\\` - 反斜杠本身需要双重转义

### 示例

**检测阿里云 AccessKey**:
```regex
\bLTAI[A-Za-z\d]{12,30}\b
```
- `\b` - 单词边界,确保不会匹配部分字符串
- `LTAI` - 固定前缀
- `[A-Za-z\d]{12,30}` - 12-30 个字母或数字
- `\b` - 单词边界

**检测 JWT Token**:
```regex
eyJ[A-Za-z0-9_/+\-]{10,}={0,2}\.[A-Za-z0-9_/+\-]{15,}={0,2}\.[A-Za-z0-9_/+\-]{10,}={0,2}
```
- `eyJ` - JWT 固定开头 (base64 编码的 `{"`)
- 三段式结构,用 `.` 分隔
- `={0,2}` - 可选的 base64 填充符

## 性能考虑

### 规则数量影响

- 每个启用的规则会增加一次正则匹配
- 29 个默认规则对性能影响可接受
- 建议禁用不需要的规则以提升性能

### 正则表达式优化

**好的实践**:
```regex
\bAKIA[A-Z0-9]{16}\b
```
- 使用 `\b` 限制边界
- 明确指定字符集和长度
- 避免贪婪匹配

**不好的实践**:
```regex
.*secret.*
```
- 过于宽泛,容易误报
- 贪婪匹配 `.*` 影响性能

## 误报处理

### 常见误报

1. **手机号规则** (默认禁用)
   - 容易匹配到无关的 11 位数字
   - 建议仅在特定场景启用

2. **密码字段规则**
   - 可能匹配到示例代码
   - 需要结合上下文判断

### 减少误报

1. 调整正则表达式使其更精确
2. 提高熵值阈值过滤简单密码
3. 增加最小长度限制
4. 使用黑名单排除测试域名

## 常见问题

### Q: 为什么手机号规则默认禁用?
A: 手机号格式与普通数字相似,容易产生误报。建议只在明确需要时启用。

### Q: 如何添加自己公司的密钥格式?
A: 在分析引擎设置中点击"添加规则",输入公司特有的密钥格式正则表达式。

### Q: 规则可以导出分享吗?
A: 可以,在设置中导出配置 JSON 文件,其中包含所有自定义规则。

### Q: 修改规则后需要重启扫描吗?
A: 不需要,配置保存后立即生效,下次扫描会使用新规则。

## 安全建议

1. **定期审查规则**: 根据实际检测效果调整规则
2. **关注漏报**: 如发现遗漏的密钥类型,及时添加规则
3. **优化误报**: 通过调整正则和阈值减少误报
4. **分享规则**: 将有效的规则分享给团队使用

---

**版本**: 3.0.0
**规则数量**: 29 条
**更新日期**: 2026-02-04
